<%-include('../layouts/header.ejs')%>
<%-include('../layouts/navbar.ejs')%>

<style>
    .text-red {
        color: red;
    }
    .small-text {
        font-size: 12px; /* Adjust the font size as needed */
    }

    .password-wrapper {
        position: relative;
    }
    .form-control {
    border: 1px solid #000;
    border-radius: 5px;
    padding: 10px;
    margin-bottom: 20px;
}
    .password-icon {
        position: absolute;
        top: 50%;
        right: 10px;
        transform: translateY(-50%);
        cursor: pointer;
    }

    .password-rules {
        display: none;
        margin-top: 5px;
        font-size: 12px;
        color: #999;
    }
    .button-container {
    text-align: center;
    display: flex;
    justify-content: center;
}

.btn-outline-primary-2 {
    border: 1px solid black; /* Black border */
    color: black; /* Black text */
    background-color: transparent; /* Transparent background */
}
.google-account {
    text-align: center;
    border: 1px solid black;
    color: blue;
}
.btn-outline-primary-2:hover {
    background-color: black; /* Change background color on hover */
    color: white; /* Change text color on hover */
}
.forgot-link {
    color: black !important; /* Change link color to black */
}
.red-btn {
    
    color: red;
}



</style>

<div class="page-wrapper">
    <main class="main">

        <div class="login-page bg-image pt-8 pb-8 pt-md-12 pb-md-12 pt-lg-17 pb-lg-17" style="background-image: url('assets/images/backgrounds/login-bg.jpg')">
            <div class="container">
                <div class="form-box">
                    <div class="form-tab">
                        <div class="text-center">
                            <img src="/assets/images/logo.png" alt="RUSH GAMES LOGO" width="150px" height="150px" style="display: block; margin: 0 auto;">
                        </div>
                        <ul class="nav nav-pills nav-fill" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="register-tab-2" data-toggle="tab" href="#register-2" role="tab" aria-controls="register-2" aria-selected="true">Sign in</a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="register-2" role="tabpanel" aria-labelledby="register-tab-2">
                                <form method="post" action="/loginSubmit" onsubmit="return validation()">
                                    
                                    <% if (errmsg) { %> 
                                        <div class="alert alert-danger text-center" role="alert" style="color: red; background: white;">
                                            <%= errmsg %>
                                        </div>
                                    <% } %>
                                        
                                    <div class="form-group">
                                        <label for="register-email">Your email address *</label>
                                        <input type="text" class="form-control" id="register-email" name="email" >
                                        <p id="errorEmail" style="color: red"></p>
                                    </div><!-- End .form-group -->

                                 

                                    

                                    <div class="form-group">
                                        <label for="register-password">Password *</label>
                                        <div class="password-wrapper">
                                            <input type="password" class="form-control" id="register-password" name="password" >
                                            <p id="errorPassword" style="color: red;"></p>
                                            <div class="password-icon" onmouseover="showPasswordRules()" onmouseout="hidePasswordRules()">ℹ️</div>
                                        </div>
                                        <div class="password-rules" id="passwordRules">
                                            Password Rules: <br>
                                            * Must be at least 8 characters long<br>
                                            * Must contain at least:<br>
                                                - One uppercase letter.<br>
                                                - One lowercase letter.<br>
                                                - One number.<br>
                                                - One special character.
                                        </div>
                                    </div>
                                    <br><br>
                                    
                                   

                                    <div class="form-footer">
                                        <div id="validation-message"></div>
                                        
                                        <!-- Top button container -->
                                        <div class="button-container">
                                            <button type="submit" class="btn btn-outline-primary-2">
                                                <span>SIGN IN</span>
                                                <i class="icon-long-arrow-right"></i>
                                            </button>
                                            
                                        </div>
                                        <br><br>
                                        <!-- Bottom button container -->
                                        <div class="button-container">
                                            <a type="button" class="btn btn-outline-primary-2" id="forgotPassword" data-toggle="modal" data-target="#forgotPasswordModal">
                                                <span>Forgot Password?</span>
                                                <i class="icon-long-arrow-right"></i>
                                            </a>
                                        </div>
                                        <br>
                                        <div class="button-container">
                                            <a href="/auth/google" class="btn google-account red-btn">
                                                <i class="fab fa-google" style="color: red;"></i> <!-- Google icon -->
                                                <span style="color: red;">Google Account</span>                                     
                                            </a>
                                        </div>
                                        
                                        
                                        <!-- Checkbox -->
                                        <br>
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="register-policy-2" required>
                                            <label class="custom-control-label" for="register-policy-2">I agree to the <a href="#">privacy policy</a> *</label>
                                        </div><!-- End .custom-checkbox -->
                                    </div><!-- End .form-footer -->
                                    
                                </form>
                                <div class="text-center font-weight-bold">
                                    <p>
                                        <span>New Here ?</span>
                                        <a href="/register" class="forgot-link font-weight-bold">Create an Account</a>
                                    </p>
                                </div>
                                
                            </div><!-- .End .tab-pane -->
                        </div><!-- End .tab-content -->
                    </div><!-- End .form-tab -->
                </div><!-- End .form-box -->
            </div><!-- End .container -->
        </div><!-- End .login-page section-bg -->
    </main><!-- End .main -->
</div><!-- End .page-wrapper -->

<button id="scroll-top" title="Back to Top"><i class="icon-arrow-up"></i></button>




<script>
        function validation(){

            let email = document.getElementById("register-email").value.trim();
            let password = document.getElementById("register-password").value.trim();

            let emailRegex = /^[^\s@]+@[^\s@]+\.(?:com)$/i;
            let passwordRegex = /^.{5,}$/;

            let errorEmail = document.getElementById("errorEmail");
            let errorPassword = document.getElementById("errorPassword");

            errorEmail.innerText = "";
            errorPassword.innerText = "";

                // ****** VALIDATE EMAIL ******
                if (email === "") {
                    errorEmail.innerText = "Email cannot be empty";
                    return false;
                } else if (!emailRegex.test(email)) {
                    errorEmail.innerText = "Please enter a valid email address ending with .com";
                    return false;
                }

                // ****** VALIDATE PASSWORD ******
                if (password === "") {
                    errorPassword.innerText = "Password cannot be empty";
                    return false;
                } else if (!passwordRegex.test(password)) {
                    errorPassword.innerText = "Password must be at least 5 characters long";
                    return false;
                }

                return true;
        }

</script>



<!-------- verifying the forgot password email ------------ -->
<div class="modal fade" id="forgotPasswordModal" tabindex="-1" role="dialog" aria-labelledby="forgotPasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
      <div class="modal-content bg-black text-red px-5 mt-4 mb-4">
        <br>
        <div class="modal-header border-bottom-red">
            
          <h5 class="modal-title text-center" id="forgotPasswordModalLabel">ENTER YOUR EMAIL ID</h5>
          <button type="button" class="close text-red" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="addressForm">
            <div class="col-md-12">
                <div class="form-group"><br>
                  <label for="email" class="text-red">Email</label><br><br>
                  <input type="text" class="form-control" id="email" placeholder="Enter Your Email" required><br><br>
                </div>
              </div>
            <button type="submit" class="btn btn-success btn-block" id="submitEmailBtn">Submit</button>
            <br><br>
          </form>
        </div>
      </div>
    </div>
</div>



<script>
  document.getElementById('submitEmailBtn').addEventListener('click', function(event) {
    event.preventDefault();

    const email = document.getElementById('email').value.trim();
    const emailRegex = /^[^\s@]+@[^\s@]+\.(?:com)$/i;

    if (!emailRegex.test(email)) {
        Swal.fire({
            icon: 'error',
            title: 'Error',
            text: 'Please enter a valid email address ending with ".com"'
        });
        return false;
    }

    let formData = { email: email };

    fetch('/verifyForgotEmail', {
        method: 'POST',
        headers: {
            "Content-Type": 'application/json'
        },
        body: JSON.stringify(formData)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        if(data.message === "nouser"){
            Swal.fire({
                    icon: 'error',
                    title: 'ERROR',
                    text: 'Email is Incorrect', 
                });
        }
        window.location.href = `/otp?email=${data.email}`;
    })
    .catch(error => {
        console.error('There was a problem with the fetch operation:', error);
        Swal.fire({
            icon: 'error',
            title: 'Error',
            text: 'An error occurred while processing your request. Please try again later.'
        });
    });
});

</script>


<%-include('../layouts/footbar.ejs')%>

<%-include('../layouts/footer.ejs')%>